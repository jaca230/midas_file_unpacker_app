{
  "plugin_libraries": [
    "build/lib/libunpacker_data_products_nalu.so",
    "build/lib/libunpacker_stages_nalu.so"
  ],
  "pipeline": [
    {
      "id": "event_header_unpacker",
      "type": "ByteStreamToDataProductStage",
      "parameters": {
        "input_byte_stream_product_name": "bytestream_bank_AD%0",
        "root_class_name": "dataProducts::NaluEventHeader",
        "data_product_name": "NaluEventHeader",
        "field_mappings": {
          "event_header":         { "offset": 0,  "size": 2, "endianness": "little" },
          "event_info":           { "offset": 2,  "size": 1, "endianness": "little" },
          "event_index":          { "offset": 3,  "size": 4, "endianness": "little" },
          "event_reference_time": { "offset": 7,  "size": 4, "endianness": "little" },
          "packet_size":          { "offset": 11, "size": 2, "endianness": "little" },
          "channel_mask":         { "offset": 13, "size": 8, "endianness": "little" },
          "num_windows":          { "offset": 21, "size": 1, "endianness": "little" },
          "num_packets":          { "offset": 22, "size": 2, "endianness": "little" }
        }
      },
      "next": ["packet_unpacker"]
    },
    {
      "id": "packet_unpacker",
      "type": "ByteStreamProcessorRepeatingSequenceStage",
      "parameters": {
        "input_byte_stream_product_name": "bytestream_bank_AD%0",
        "repeat_count_product_name": "NaluEventHeader",
        "repeat_count_product_member": "num_packets",
        "pipeline_config": {
          "pipeline": [
            {
              "id": "packet_header_unpacker",
              "type": "ByteStreamToDataProductStage",
              "parameters": {
                "input_byte_stream_product_name": "bytestream_bank_AD%0",
                "root_class_name": "dataProducts::NaluPacketHeader",
                "data_product_name": "NaluPacketHeader",
                "field_mappings": {
                  "packet_header":     { "offset": 0,  "size": 2, "endianness": "little" },
                  "packet_info":       { "offset": 2,  "size": 1, "endianness": "little" },
                  "channel":           { "offset": 3,  "size": 1, "endianness": "little" },
                  "trigger_time":      { "offset": 4,  "size": 4, "endianness": "little" },
                  "logical_position":  { "offset": 8,  "size": 2, "endianness": "little" },
                  "window_position":   { "offset": 10, "size": 2, "endianness": "little" }
                }
              },
              "next": ["packet_payload_unpacker"]
            },
            {
              "id": "packet_payload_unpacker",
              "type": "ByteStreamToDataProductStage",
              "parameters": {
                "input_byte_stream_product_name": "bytestream_bank_AD%0",
                "root_class_name": "dataProducts::NaluPacketPayload",
                "data_product_name": "NaluPacketPayload",
                "field_mappings": {
                  "trace[32]": { "offset": 0, "size": 64, "endianness": "big" }
                }
              },
              "next": ["packet_footer_unpacker"]
            },
            {
              "id": "packet_footer_unpacker",
              "type": "ByteStreamToDataProductStage",
              "parameters": {
                "input_byte_stream_product_name": "bytestream_bank_AD%0",
                "root_class_name": "dataProducts::NaluPacketFooter",
                "data_product_name": "NaluPacketFooter",
                "field_mappings": {
                  "parser_index":  { "offset": 0, "size": 2, "endianness": "little" },
                  "packet_footer": { "offset": 2, "size": 2, "endianness": "little" }
                }
              },
              "next": []
            }
          ]
        }
      },
      "next": ["event_footer_unpacker"]
    },
    {
      "id": "event_footer_unpacker",
      "type": "ByteStreamToDataProductStage",
      "parameters": {
        "input_byte_stream_product_name": "bytestream_bank_AD%0",
        "root_class_name": "dataProducts::NaluEventFooter",
        "data_product_name": "NaluEventFooter",
        "field_mappings": {
          "event_footer": { "offset": 0, "size": 2, "endianness": "little" }
        }
      },
      "next": ["packet_collection_former"]
    },
    {
      "id": "packet_collection_former",
      "type": "NaluPacketCollectionFormingStage",
      "parameters": {
        "header_prefix": "NaluPacketHeader",
        "payload_prefix": "NaluPacketPayload",
        "footer_prefix": "NaluPacketFooter",
        "output_product": "NaluPacketCollection"
      },
      "next": ["event_former"]
    },
    {
      "id": "event_former",
      "type": "NaluEventFormingStage",
      "parameters": {
        "header_name": "NaluEventHeader",
        "footer_name": "NaluEventFooter",
        "packet_collection": "NaluPacketCollection",
        "output_product": "NaluEvent"
      },
      "next": []
    }
  ]
}
